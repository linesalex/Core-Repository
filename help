# Remove current Node.js 12
sudo rm -rf /usr/local/bin/node /usr/local/bin/npm /usr/local/lib/node_modules

# Download Node.js 14 (supports the syntax but still RHEL 7 compatible)
cd /tmp
wget https://nodejs.org/dist/v14.21.3/node-v14.21.3-linux-x64.tar.xz
tar -xJf node-v14.21.3-linux-x64.tar.xz
sudo cp -r node-v14.21.3-linux-x64/* /usr/local/

# Verify upgrade
source ~/.bashrc
node --version  # Should show v14.21.3
npm --version   # Should show 6.x.x

cd /root/Core-Repository/backend

# Remove node_modules and reinstall with Node.js 14
rm -rf node_modules package-lock.json

# Install compatible bcrypt version for Node.js 14
npm install bcrypt@5.1.1 --save

# Install other dependencies
npm install

# Test database initialization
node init_db.js
node migration_script.js

cd /root/Core-Repository/backend

# Edit package.json to use older bcrypt
npm install bcrypt@5.1.1 --save

# Reinstall all dependencies
rm -rf node_modules package-lock.json
npm install

# Initialize database
cd /root/Core-Repository/backend
node init_db.js
node migration_script.js

# Start backend
npm start  # Should now work without syntax errors

# In another terminal, start frontend
cd /root/Core-Repository/frontend
npm start